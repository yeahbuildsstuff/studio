<!DOCTYPE html><html><head><meta charset="UTF-8"><title>InteractiveStudioâ„¢</title>
<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/cannon.js"></script>
<style>
body{margin:0;background:#f0f0f0;color:#222;font-family:Arial;height:100vh;display:flex;flex-direction:column;}
#topbar{display:flex;align-items:center;background:#e0e0e0;padding:8px;gap:10px;border-bottom:1px solid #ccc;}
#topbar button{padding:6px 12px;background:#fff;border:1px solid #aaa;color:#222;cursor:pointer;border-radius:3px;}
#main{flex:1;display:flex;overflow:hidden;}
#leftSide{flex:3;display:flex;flex-direction:column;border-right:1px solid #ccc;}
#viewport{flex:3;background:#000;}
#viewport canvas{width:100%;height:100%;}
#bottomBar{height:24px;background:#e0e0e0;border-top:1px solid #ccc;font-size:12px;display:flex;align-items:center;padding-left:8px;color:#555;}
#rightSide{flex:1;display:flex;flex-direction:column;background:#f7f7f7;}
#rightTabs{display:flex;border-bottom:1px solid #ccc;background:#eaeaea;}
#rightTabs button{flex:1;padding:6px;border:none;border-right:1px solid #ccc;background:#eaeaea;cursor:pointer;font-size:13px;}
#rightTabs button.active{background:#fff;font-weight:bold;}
#rightContent{flex:1;overflow-y:auto;padding:8px;}
.folder{margin-bottom:12px;}
.folder strong{display:block;margin-bottom:4px;}
.folderContent div{padding-left:10px;cursor:pointer;padding-top:2px;padding-bottom:2px;font-size:13px;}
.folderContent div.selected{background:#d0e4ff;}
.propRow{margin-bottom:6px;font-size:13px;}
.propRow label{display:inline-block;width:90px;}
.propRow input{background:#fff;border:1px solid #aaa;color:#222;margin-bottom:2px;width:80px;font-size:12px;padding:2px;}
.propRow input[type=checkbox]{width:auto;}
.hint{font-size:12px;color:#777;}
</style></head><body>

<div id="topbar">
<button id="addPartBtn">Part</button>
<button id="addToolBtn">Tool</button>
<div style="flex:1"></div>
<button id="exportBtn">Export</button>
</div>

<div id="main">
<div id="leftSide">
<div id="viewport"><canvas id="renderCanvas"></canvas></div>
<div id="bottomBar">FreeCam: WASD + mouse drag</div>
</div>

<div id="rightSide">
<div id="rightTabs">
<button id="tabExplorer" class="active">Explorer</button>
<button id="tabProperties">Properties</button>
</div>
<div id="rightContent">
<div id="explorerView">
<h3>Explorer</h3>
<div class="folder" id="objectService"><strong>ObjectService</strong><div class="folderContent"></div></div>
<div class="folder" id="toolService"><strong>ToolService</strong><div class="folderContent"></div></div>
</div>
<div id="propertiesView" style="display:none;">
<h3>Properties</h3>
<div id="propContent"></div>
<div class="hint">Select an object or tool in Explorer.</div>
</div>
</div>
</div>
</div>

<script>
//==============================================================
// DATA
//==============================================================
const ObjectService=[];const ToolService=[];let selectedObject=null;

//==============================================================
// BABYLON SETUP
//==============================================================
const canvas=document.getElementById("renderCanvas");
const engine=new BABYLON.Engine(canvas,true);
const scene=new BABYLON.Scene(engine);

const camera=new BABYLON.FreeCamera("cam",new BABYLON.Vector3(0,10,-20),scene);
camera.attachControl(canvas,true);camera.speed=0.5;
camera.keysUp=[87];camera.keysDown=[83];camera.keysLeft=[65];camera.keysRight=[68];

// SKYBOX + SUN (EDITOR ONLY)
const skybox=BABYLON.MeshBuilder.CreateBox("skyBox",{size:2000},scene);
const skyMat=new BABYLON.StandardMaterial("skyMat",scene);
skyMat.backFaceCulling=false;skyMat.disableLighting=true;
skyMat.reflectionTexture=new BABYLON.CubeTexture(
"https://raw.githubusercontent.com/yeahbuildsstuff/GameAssetServiceRepo/main/null_plainsky512/null_plainsky512",
scene,["_rt.jpg","_up.jpg","_ft.jpg","_lf.jpg","_dn.jpg","_bk.jpg"]);
skyMat.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE;
skybox.material=skyMat;skybox.infiniteDistance=true;

const sunMgr=new BABYLON.SpriteManager("sunMgr",
"https://raw.githubusercontent.com/yeahbuildsstuff/GameAssetServiceRepo/main/sun.png",
1,{width:512,height:512},scene);
const sunSprite=new BABYLON.Sprite("sun",sunMgr);
sunSprite.size=160;sunSprite.position=new BABYLON.Vector3(200,100,200);
sunSprite.isPickable=false;

const sun=new BABYLON.DirectionalLight("sun",new BABYLON.Vector3(-1,-1,-1),scene);
sun.position=new BABYLON.Vector3(10,10,-10);sun.intensity=0.52;

const ambient=new BABYLON.HemisphericLight("amb",new BABYLON.Vector3(0,1,0),scene);
ambient.diffuse=new BABYLON.Color3(210/255,210/255,210/255);
ambient.groundColor=new BABYLON.Color3(210/255,210/255,210/255);
ambient.intensity=0.6;

engine.runRenderLoop(()=>scene.render());
window.addEventListener("resize",()=>engine.resize());

//==============================================================
// BASEPLATE
//==============================================================
function createBaseplate(){
const base={
id:crypto.randomUUID(),type:"Part",name:"Baseplate",
color:{r:.7,g:.7,b:.7},position:{x:0,y:-10,z:0},
size:{x:64,y:.5,z:64},rotation:{x:0,y:0,z:0},
shape:"Block",draggable:false,anchored:true,collision:true,mesh:null
};
ObjectService.push(base);createMeshForPart(base);
}

//==============================================================
// EXPLORER
//==============================================================
function refreshExplorer(){
const obj=document.querySelector("#objectService .folderContent");
const tool=document.querySelector("#toolService .folderContent");
obj.innerHTML="";tool.innerHTML="";
ObjectService.forEach(o=>{
let d=document.createElement("div");d.textContent=o.name;
if(selectedObject===o)d.classList.add("selected");
d.onclick=()=>selectObject(o);obj.appendChild(d);
});
ToolService.forEach(t=>{
let d=document.createElement("div");d.textContent=t.name;
if(selectedObject===t)d.classList.add("selected");
d.onclick=()=>selectObject(t);tool.appendChild(d);
});
}

//==============================================================
// CREATE PART / TOOL
//==============================================================
function addPart(){
const p={
id:crypto.randomUUID(),type:"Part",name:"Part",
color:{r:1,g:1,b:1},position:{x:0,y:1,z:0},
size:{x:2,y:2,z:2},rotation:{x:0,y:0,z:0},
shape:"Block",draggable:true,anchored:false,collision:true,mesh:null
};
ObjectService.push(p);createMeshForPart(p);refreshExplorer();
}
function addTool(){
const t={id:crypto.randomUUID(),type:"Tool",name:"NewTool",toolType:"Grab"};
ToolService.push(t);refreshExplorer();
}

//==============================================================
// MESH CREATION
//==============================================================
function createMeshForPart(part){
let mesh;
if(part.shape==="Block"){
mesh=BABYLON.MeshBuilder.CreateBox(part.id,{width:part.size.x,height:part.size.y,depth:part.size.z},scene);
}else if(part.shape==="Sphere"){
mesh=BABYLON.MeshBuilder.CreateSphere(part.id,{diameter:part.size.x},scene);
}else if(part.shape==="Cylinder"){
mesh=BABYLON.MeshBuilder.CreateCylinder(part.id,{height:part.size.x,diameter:part.size.y},scene);
mesh.rotation.z=Math.PI/2;
}
mesh.position=new BABYLON.Vector3(part.position.x,part.position.y,part.position.z);
mesh.rotation.x+=part.rotation.x;mesh.rotation.y+=part.rotation.y;mesh.rotation.z+=part.rotation.z;
const mat=new BABYLON.StandardMaterial(part.id+"_mat",scene);
mat.diffuseColor=new BABYLON.Color3(part.color.r,part.color.g,part.color.b);
mesh.material=mat;part.mesh=mesh;
}

//==============================================================
// SYNC MESH
//==============================================================
function syncPartToMesh(p){
if(!p.mesh)return;
p.mesh.position.set(p.position.x,p.position.y,p.position.z);
p.mesh.scaling.set(p.size.x/2,p.size.y/2,p.size.z/2);
p.mesh.rotation.set(p.rotation.x,p.rotation.y,p.rotation.z);
p.mesh.material.diffuseColor=new BABYLON.Color3(p.color.r,p.color.g,p.color.b);
}

//==============================================================
// SELECT + PROPERTIES
//==============================================================
function selectObject(o){selectedObject=o;refreshExplorer();refreshProperties();showPropertiesTab();}
function refreshProperties(){
const panel=document.getElementById("propContent");panel.innerHTML="";
if(!selectedObject){panel.innerHTML="<div class='hint'>Select something.</div>";return;}
const o=selectedObject;
if(o.type==="Tool"){
panel.appendChild(makeInput("Name",o.name,v=>{o.name=v;refreshExplorer();}));
panel.appendChild(makeInput("Type",o.toolType,v=>o.toolType=v));
}
if(o.type==="Part"){
panel.appendChild(makeInput("Name",o.name,v=>{o.name=v;refreshExplorer();}));
panel.appendChild(makeInput("Shape",o.shape,v=>{o.shape=v;if(o.mesh)o.mesh.dispose();createMeshForPart(o);}));
panel.appendChild(makeCheck("Draggable",o.draggable,v=>o.draggable=v));
panel.appendChild(makeCheck("Anchored",o.anchored,v=>o.anchored=v));
panel.appendChild(makeCheck("Collision",o.collision,v=>o.collision=v));
panel.appendChild(makeInput("Color R",o.color.r,v=>{o.color.r=parseFloat(v)||0;syncPartToMesh(o);}));
panel.appendChild(makeInput("Color G",o.color.g,v=>{o.color.g=parseFloat(v)||0;syncPartToMesh(o);}));
panel.appendChild(makeInput("Color B",o.color.b,v=>{o.color.b=parseFloat(v)||0;syncPartToMesh(o);}));
panel.appendChild(makeInput("Pos X",o.position.x,v=>{o.position.x=parseFloat(v)||0;syncPartToMesh(o);}));
panel.appendChild(makeInput("Pos Y",o.position.y,v=>{o.position.y=parseFloat(v)||0;syncPartToMesh(o);}));
panel.appendChild(makeInput("Pos Z",o.position.z,v=>{o.position.z=parseFloat(v)||0;syncPartToMesh(o);}));
panel.appendChild(makeInput("Size X",o.size.x,v=>{o.size.x=parseFloat(v)||1;syncPartToMesh(o);}));
panel.appendChild(makeInput("Size Y",o.size.y,v=>{o.size.y=parseFloat(v)||1;syncPartToMesh(o);}));
panel.appendChild(makeInput("Size Z",o.size.z,v=>{o.size.z=parseFloat(v)||1;syncPartToMesh(o);}));
panel.appendChild(makeInput("Rot X",o.rotation.x,v=>{o.rotation.x=parseFloat(v)||0;syncPartToMesh(o);}));
panel.appendChild(makeInput("Rot Y",o.rotation.y,v=>{o.rotation.y=parseFloat(v)||0;syncPartToMesh(o);}));
panel.appendChild(makeInput("Rot Z",o.rotation.z,v=>{o.rotation.z=parseFloat(v)||0;syncPartToMesh(o);}));
}
}
function makeInput(label,val,on){let r=document.createElement("div");r.className="propRow";
let l=document.createElement("label");l.textContent=label+": ";
let i=document.createElement("input");i.value=val;i.onchange=()=>on(i.value);
r.appendChild(l);r.appendChild(i);return r;}
function makeCheck(label,val,on){let r=document.createElement("div");r.className="propRow";
let l=document.createElement("label");l.textContent=label+": ";
let i=document.createElement("input");i.type="checkbox";i.checked=val;i.onchange=()=>on(i.checked);
r.appendChild(l);r.appendChild(i);return r;}

//==============================================================
// TABS
//==============================================================
const tabE=document.getElementById("tabExplorer");
const tabP=document.getElementById("tabProperties");
const viewE=document.getElementById("explorerView");
const viewP=document.getElementById("propertiesView");
function showExplorerTab(){tabE.classList.add("active");tabP.classList.remove("active");viewE.style.display="block";viewP.style.display="none";}
function showPropertiesTab(){tabE.classList.remove("active");tabP.classList.add("active");viewE.style.display="none";viewP.style.display="block";}
tabE.onclick=showExplorerTab;tabP.onclick=showPropertiesTab;

//==============================================================
// EXPORTER
//==============================================================
async function loadDefaultClient(){let r=await fetch("StudioAssets/defaultclient.html");return await r.text();}
function genTools(){return ToolService.map(t=>`  { type: "${t.toolType}", name: "${t.name}" }`).join(",\n");}
function genPLACE(){
let out=`function PLACE_CODE(scene){\n\n`;
ObjectService.forEach((p,i)=>{
if(p.type!=="Part")return;
let m=`part_${i}`,mat=`mat_${i}`;
if(p.shape==="Block"){
out+=`const ${m}=BABYLON.MeshBuilder.CreateBox("${m}",{width:${p.size.x},height:${p.size.y},depth:${p.size.z}},scene);\n`;
}else if(p.shape==="Sphere"){
out+=`const ${m}=BABYLON.MeshBuilder.CreateSphere("${m}",{diameter:${p.size.x}},scene);\n`;
}else if(p.shape==="Cylinder"){
out+=`const ${m}=BABYLON.MeshBuilder.CreateCylinder("${m}",{height:${p.size.x},diameter:${p.size.y}},scene);\n`;
out+=`${m}.rotation.z=Math.PI/2;\n`;
}
out+=`${m}.position.set(${p.position.x},${p.position.y},${p.position.z});\n`;
out+=`${m}.rotation.set(${p.rotation.x},${p.rotation.y},${p.rotation.z});\n`;
out+=`const ${mat}=new BABYLON.StandardMaterial("${mat}",scene);\n`;
out+=`${mat}.diffuseColor=new BABYLON.Color3(${p.color.r},${p.color.g},${p.color.b});\n`;
out+=`${m}.material=${mat};\n`;
out+=`const shape_${i}=new CANNON.Box(new CANNON.Vec3(${p.size.x/2},${p.size.y/2},${p.size.z/2}));\n`;
out+=`const body_${i}=new CANNON.Body({mass:${p.anchored?0:1},shape:shape_${i},material:groundMatPhys});\n`;
out+=`body_${i}.position.set(${p.position.x},${p.position.y},${p.position.z});\n`;
if(p.collision) out+=`world.addBody(body_${i});\n`;
if(p.draggable) out+=`if(makeDraggableRef){makeDraggableRef(${m});}\n`;
out+=`\n`;
});
out+=`}\n`;return out;
}
function applyMods(html){
let tStart=html.indexOf("const toolDeclarations");
if(tStart!==-1){
let o=html.indexOf("[",tStart),c=html.indexOf("]",o);
html=html.substring(0,o+1)+"\n"+genTools()+"\n"+html.substring(c);
}
let pStart=html.indexOf("function PLACE_CODE(scene)");
if(pStart!==-1){
let o=html.indexOf("{",pStart),d=1,i=o+1;
while(i<html.length&&d>0){if(html[i]=="{")d++;if(html[i]=="}")d--;i++;}
html=html.substring(0,pStart)+genPLACE()+html.substring(i);
}
return html;
}
function download(html){
let b=new Blob([html],{type:"text/html"});
let u=URL.createObjectURL(b);let a=document.createElement("a");
a.href=u;a.download="InteractiveClient.html";a.click();URL.revokeObjectURL(u);
}
async function exportClient(){let h=await loadDefaultClient();h=applyMods(h);download(h);}

//==============================================================
// INIT
//==============================================================
document.getElementById("addPartBtn").onclick=addPart;
document.getElementById("addToolBtn").onclick=addTool;
document.getElementById("exportBtn").onclick=exportClient;
createBaseplate();
refreshExplorer();
refreshProperties();

</script>
</body>
</html>
